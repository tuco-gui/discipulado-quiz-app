<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Show do Crentão — Sobrenatural Church</title>
  <meta name="theme-color" content="#000000" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    /* ... (todo o mesmo CSS que já estava no seu código) ... */
  </style>
</head>
<body>
  <!-- (o mesmo HTML da versão que você mandou, sem cortar nada) -->

<script>
(async function(){
  /* ---------- Supabase ---------- */
  const SUPABASE_URL = "https://ihajmegcdgwchxslnaep.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImloYWptZWdjZGd3Y2h4c2xuYWVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0OTQzMTgsImV4cCI6MjA3MjA3MDMxOH0.WM36lA9n0PU9qd-DKdrWVB_UzGVXpsfJ984oHiXDU8Y";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  /* ---------- refs ---------- */
  // (mantém todas as refs, áudios, funções utilitárias, etc — igual no seu código atual)

  /* ---------- storage -> trocado por Supabase ---------- */
  async function salvarRanking(registro){
    const { error } = await supabase.from("ranking").insert([registro]);
    if(error) console.error("Erro ao salvar no Supabase:", error);
  }

  async function listarRanking(){
    const { data, error } = await supabase.from("ranking").select("*").order("tesouro",{ascending:false}).order("pontos",{ascending:false}).order("quando",{ascending:true});
    if(error){ console.error("Erro ao listar:", error); return []; }
    return data;
  }

  async function zerarRanking(){
    const { error } = await supabase.from("ranking").delete().neq("id",0);
    if(error) console.error("Erro ao zerar ranking:", error);
  }

  /* ---------- finalizar (agora grava no Supabase) ---------- */
  function finalizar(parou=false, pulouNoFim=false, errou=false){
    let tesouro=0;
    if (parou) {
      tesouro = ladder[idx];
    } else if (errou) {
      tesouro = calculaCheckpoint();
    } else {
      tesouro = acertos===perguntas.length ? ladder[ladder.length-1] : calculaCheckpoint();
    }

    const registro={
      nome:participanteAtual.nome,
      fone:participanteAtual.fone,
      pontos:Number(acertos)||0,
      tesouro:Number(tesouro)||0,
      quando:new Date().toISOString()
    };

    salvarRanking(registro).then(()=> renderRanking());
    hideAll(); toggleLogo(true); secRank.style.display='block';
  }

  /* ---------- render ranking ---------- */
  async function renderRanking(){
    const rank=await listarRanking();
    const box=document.getElementById("rankingLista");
    if(!rank.length){ box.textContent="Sem participantes por enquanto."; return; }
    const linhas=rank.map((r,i)=> `${i+1}. ${r.nome} — ${r.fone} — ${r.tesouro.toLocaleString('pt-BR')} talento(s) · ${r.pontos} acerto(s)`);
    box.innerHTML=linhas.map(l=>`<div style="padding:6px 0;border-bottom:1px solid rgba(255,255,255,.06)">${l}</div>`).join('');
  }

  /* ---------- botão reset ---------- */
  const btnResetDev=document.getElementById("btnResetDev");
  if(location.hash==="#dev"){
    btnResetDev.classList.remove("hidden");
    btnResetDev.addEventListener("click", async ()=>{
      if(confirm("Apagar todos os resultados do ranking no Supabase?")){
        await zerarRanking();
        renderRanking();
        alert("Ranking limpo no Supabase.");
      }
    });
  }

  // (todo o resto do código permanece igual: iniciarQuiz, renderPergunta, lifelines, áudios, etc.)
})();
</script>
</body>
</html>

